name = "lianlema-backend"
main = "src/index.ts"
compatibility_date = "2024-11-01"
compatibility_flags = ["nodejs_compat"]
workers_dev = true

routes = [
  { pattern = "api-lite.izlx.de5.net", custom_domain = true }
]

[vars]
LLM_PROVIDER = "workers_ai"
LLM_MODEL = "@cf/zai-org/glm-4.7-flash"
LLM_FALLBACK_MODELS = "@cf/meta/llama-3.1-8b-instruct"
ROLE_LLM_MODEL = "@cf/meta/llama-3.1-8b-instruct"
ALLOWED_ORIGINS = "http://localhost:8081"
ACTIVE_AI_ROLE = "trainer"
WRITEBACK_MODE = "local_first"
AGENT_FLOW_MODE = "governed"
AGENT_APPROVAL_FALLBACK = "auto_approve"
AGENT_EXECUTION_PROFILE_DEFAULT = "build"
AGENT_DEBUG_ENABLED = "false"
AGENT_STREAM_PERSIST_ENABLED = "false"

# Secrets (set via: wrangler secret put <NAME>)
# JWT_SECRET
# OPENAI_API_KEY
# ANTHROPIC_API_KEY

[[d1_databases]]
binding = "DB"
database_name = "lianlema-db"
database_id = "00961e6f-b7be-46f1-90da-3f4538a79232"

[[kv_namespaces]]
binding = "KV"
id = "5fd36595d91e42a5b629fa4a541754ea"

[[r2_buckets]]
binding = "R2"
bucket_name = "lianlema-images"

[ai]
binding = "AI"

[durable_objects]
bindings = [
  { name = "SupervisorAgent", class_name = "SupervisorAgent" }
]

[[migrations]]
tag = "v1_agents_sdk"
new_sqlite_classes = [
  "SupervisorAgent",
  "TrainerSpecialistAgent",
  "RehabSpecialistAgent",
  "NutritionistSpecialistAgent",
  "DoctorSpecialistAgent",
  "ProfileManagerAgent"
]

[[migrations]]
tag = "v2_remove_specialists"
deleted_classes = [
  "TrainerSpecialistAgent",
  "RehabSpecialistAgent",
  "NutritionistSpecialistAgent",
  "DoctorSpecialistAgent"
]

[[migrations]]
tag = "v3_remove_profile_manager"
deleted_classes = [
  "ProfileManagerAgent"
]
